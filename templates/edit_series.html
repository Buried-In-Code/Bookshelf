{% extends "edit_base.jinja" %}
{% from "components/forms.jinja" import input %}
{% block title %}Edit Series{% endblock %}
{% block form %}
  {{ input("Name", "name", value=series.name) }}
  <div class="field">
    <label class="label has-text-info">Reading Order</label>
    <div class="control is-expanded">
      <label class="label">
        <input name="reading-order" type="checkbox"{% if series.is_reading_order %} checked{% endif %}>
        Series is {% if not series.is_reading_order %}not {% endif %}a reading order.
      </label>
    </div>
  </div>
{% endblock %}
{% block action_buttons %}
  <a class="button is-success" id="save-button" onclick="saveSeries()" type="button">
    <span class="icon">
      <i class="fa-solid fa-floppy-disk"></i>
    </span>
    <span>Save</span>
  </a>
{% endblock %}
{% block js %}
  <script type="text/javascript">
    function saveSeries(){
      const caller = "save-button";
      let editForm = document.getElementById("edit-form");
      let formDetails = Object.fromEntries(new FormData(editForm));
      console.log(formDetails);

      addLoading(caller);
      fetch("/api/v0/series/{{ series.series_id }}", {
        method: "PATCH",
        headers: headers,
        body: JSON.stringify({
          "name": formDetails["name"],
          "is_reading_order": formDetails["reading-order"] === "on" ? "True" : "False"
        }),
      }).then((response) => {
        if (!response.ok){
          return Promise.reject(response);
        }
        window.location = "/series/{{ series.series_id }}";
      }).catch((response) => response.json().then((msg) => {
        alert(`${response.status} ${response.statusText}: ${msg.details}`);
      })).finally(() => removeLoading(caller));
    }
  </script>
{% endblock %}
